{"version":3,"file":"soucouyant.umd.js","sources":["../src/accumilator.js","../src/create-address.js","../src/state-object.js","../src/collection.js"],"sourcesContent":["/** \n Accumilates frames.\n\n**/\nconst accumilator = [[]];\nconst uniqueStateReferences = [];\n\nconst persistence = {\n    options: {\n        mergeFidelity: 0,\n    }\n};\n\n// Update settings.\nexport const persistenceSettings = options => Object.assign(persistence.options, options);\n\n\n// Adds a new state to the accumilator \n// May create a new frame to do so.\nexport const addNewState = (state, identity) => {\n    const currentTimeStamp = Date.now();\n    const mergeFidelity = persistence.options.mergeFidelity;\n    // Check unique states and add the state if does not yet exist.\n    // Directly reference the existing state.\n    const stateAsString = JSON.stringify(state);\n    const uniqueStateReferencesLength = uniqueStateReferences.length;\n\n    let stateExist = false;\n    let directReference;\n    for (let i = 0; i < uniqueStateReferencesLength; i++) {\n        const uniqueState = uniqueStateReferences[i];\n        const hasExistingState = JSON\n            .stringify(uniqueState) === stateAsString;\n        if (hasExistingState) {\n            directReference = uniqueState;\n            stateExist = true;\n            break;\n        }\n    }\n\n    if (stateExist === false) {\n        uniqueStateReferences.push(state);\n        directReference = uniqueStateReferences[uniqueStateReferences.length - 1];\n    }\n\n    // Find frame by timestamp\n    const accumilatorLength = accumilator.length;\n    const lastFrame = accumilator[accumilatorLength - 1];\n    const lastFrameTimeStamp = lastFrame[0];\n\n    // If within proximity merge. \n    const withinMergePeriod = lastFrameTimeStamp + mergeFidelity > currentTimeStamp;\n    if (withinMergePeriod) {\n        // merge to last frame\n        lastFrame.push([identity, directReference]);\n    } else {\n        // Add new frame.\n        accumilator.push([\n            currentTimeStamp, [\n                identity,\n                directReference\n            ]\n        ]);\n    }\n    // console.log('accumilator', JSON.stringify(accumilator, null, '\\t'));\n}\n\nexport const getCurrentState = (identity) => {\n    const accumilatorLength = accumilator.length;\n    for (let i = accumilatorLength; i > -1; --i) {\n        const frame = accumilator[i] || [];\n        const frameLength = frame.length;\n        for (let j = 0; j < frameLength; j++) {\n            if (frame[j][0] === identity) {\n                return frame[j][1];\n            }\n        }\n    }\n}","import StateObject from './state-object';\nimport { addNewState, getCurrentState } from './accumilator';\n\n\nconst stateMachine = (state, identity) => {\n    return callback => {\n        const lastState = state === null ? getCurrentState(identity) : state;\n        const newState = callback(lastState);\n        addNewState(newState, identity);\n        if (state !== null) {\n            state = null;\n        }\n    }\n}\n\nlet identity = -1;\nconst createAddress = (addressParts, count, state, length, isCollection, nextPart) => {\n    if (nextPart === null) {\n        const newPart = (addressParts[count] + '').trim();\n        if (StateObject[newPart] === undefined) {\n            nextPart = StateObject[newPart] = {};\n        } else {\n            nextPart = StateObject[newPart];\n        }\n    } else {\n        const isEndOfPath = count === length - 1;\n        const newPart = (addressParts[count] + '').trim();\n        if (nextPart[newPart] === undefined) {\n            identity++;\n            const machine = isEndOfPath ? isCollection ? state : stateMachine(state, identity) : {};\n            nextPart = nextPart[newPart] = machine;\n            if (isEndOfPath) {\n                return;\n            }\n        } else {\n            nextPart = nextPart[newPart];\n            if (isEndOfPath) {\n                return;\n            }\n        }\n\n    }\n    count++;\n    createAddress(addressParts, count, state, length, isCollection, nextPart);\n}\n\nexport default createAddress;","import createAddress from './create-address';\n\nexport default function StateObject(address, state) {\n    const addressParts = address[0].split('>');\n    const addressPartsLength = addressParts.length;\n\n    createAddress(\n        addressParts,\n        0,\n        state,\n        addressPartsLength,\n        false,\n        null\n    );\n    return StateObject\n}","import StateObject from './state-object';\nimport createAddress from './create-address';\n\n\nconst checkType = type => {\n    switch (type) {\n        case Array:\n            return [];\n        case Object:\n            return '';\n        default:\n            return type;\n            // if (Array.isArray()) {\n            //     return type;\n            // }\n    }\n}\n\nexport default (type, hasEntries = false) => {\n\n    // Get the corresponding dataset according to the type.\n    const dataset = checkType(type);\n    const isArray = Array.isArray(dataset);\n    const isObject = isArray ? false : ((dataset) + '').indexOf('Object') >= 0;\n\n    // Check if the array has entries.\n    const data = isArray && hasEntries ? type : dataset.map((item, i) => [i, item]);\n\n    // A Deletable clone. \n    let initalDataClone = Array.from(data);\n\n    const properties = {\n        data,\n        initialData: initalDataClone, // Clone inital data.\n        get entries() {\n            return this.data;\n        },\n        get states() {\n            return this.data.map(entry => entry[1]);\n        },\n        get ids() {\n            return this.data.map(entry => entry[0]);\n        },\n        update(newEntries) {\n            this.data = newEntries;\n            return this;\n        },\n        get firstId() {\n            return this.data[0][0];\n        },\n        get lastId() {\n            const length = this.data.length;\n            return this.data[length - 1][0];\n        },\n        get nextId() {\n            const length = this.data.length;\n            return this.data[length - 1][0];\n        },\n        get lastIndex() {\n            return this.data.length - 1;\n        },\n        get nextIndex() {\n            return this.data.length;\n        },\n        get firstState() {\n            return this.data[0][1];\n        },\n        get lastState() {\n            const length = this.data.length - 1;\n            console.log(length)\n            return this.data[length][1];\n        },\n        get firstEntry() {\n            return this.data[0];\n        },\n        get lastEntry() {\n            const length = this.data.length;\n            return this.data[length - 1];\n        },\n        get length() {\n            return this.data.length;\n        },\n    }\n    // return properties;\n    return (address) => {\n\n        const addressParts = address[0].split('>');\n        const addressPartsLength = addressParts.length;\n\n        createAddress(\n            addressParts,\n            0,\n            properties,\n            addressPartsLength,\n            true,\n            null\n        );\n    }\n}\n\n\n\n// get lastRemovedIds(){\n// \treturn \n// }\n// get initalLength() {\n//     return initalDataClone.length;\n// }\n// get initalEntries() {\n//     return initalDataClone;\n// }\n// get initalIds() {\n//     return initalDataClone.map(entry => entry[0]);\n// }\n// get initalStates() {\n//     return initalDataClone.map(entry => entry[0]);\n// }"],"names":["accumilator","uniqueStateReferences","persistence","addNewState","state","identity","currentTimeStamp","Date","now","mergeFidelity","options","stateAsString","JSON","stringify","uniqueStateReferencesLength","length","stateExist","directReference","i","uniqueState","hasExistingState","push","accumilatorLength","lastFrame","lastFrameTimeStamp","withinMergePeriod","getCurrentState","frame","frameLength","j","stateMachine","lastState","newState","callback","createAddress","addressParts","count","isCollection","nextPart","newPart","trim","StateObject","undefined","isEndOfPath","machine","address","split","addressPartsLength","checkType","type","Array","Object","hasEntries","dataset","isArray","isObject","indexOf","data","map","item","initalDataClone","from","properties","entries","states","entry","ids","newEntries","firstId","lastId","nextId","lastIndex","nextIndex","firstState","log","firstEntry","lastEntry"],"mappings":"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"}